# ğŸ§¬ 02_List_Evolution â€” Dynamic Array & Memory Allocation

## 0. Overview

* **Target:** Rì˜ `vector`ëŠ” ìˆ˜ì •í•  ë•Œë§ˆë‹¤ ë³µì‚¬ê°€ ì¼ì–´ë‚˜ì„œ(Copy-on-Modify) ëŠë¦¬ë‹¤ëŠ” ê±¸ ì•ˆë‹¤. ê·¸ëŸ¼ íŒŒì´ì¬ `list`ëŠ” ì™œ `append`ê°€ ë¹ ë¥¼ê¹Œ?
* **Goal:** íŒŒì´ì¬ ë¦¬ìŠ¤íŠ¸ì˜ ì‹¤ì²´ì¸ **ë™ì  ë°°ì—´(Dynamic Array)**ì˜ ì‘ë™ ì›ë¦¬(Doubling Strategy)ë¥¼ ì´í•´í•˜ê³ , `insert(0)` ê°™ì€ ** í•¨ì •**ì„ í”¼í•˜ëŠ” ë²•ì„ ìµíŒë‹¤.
* **Key Concept:** `Amortized O(1)`, `Array of Pointers`, `List Comprehension`.

---

## 1. Low-Level Theory: ë¦¬ìŠ¤íŠ¸ì˜ í•´ë¶€í•™ (Anatomy)

### 1-1. ì—°ê²° ë¦¬ìŠ¤íŠ¸(Linked List)ê°€ ì•„ë‹ˆë‹¤! ğŸš«

ë§ì€ ì‚¬ëŒë“¤ì´ íŒŒì´ì¬ `list`ë¥¼ ìë£Œêµ¬ì¡° ì±…ì—ì„œ ë³¸ 'ì—°ê²° ë¦¬ìŠ¤íŠ¸(Linked List)'ë¡œ ì°©ê°í•˜ì§€ë§Œ, **ì ˆëŒ€ ì•„ë‹ˆë‹¤.**
íŒŒì´ì¬ ë¦¬ìŠ¤íŠ¸ëŠ” C++ì˜ `std::vector`ë‚˜ Javaì˜ `ArrayList`ì™€ ê°™ì€ ë™ì  ë°°ì—´(Dynamic Array)ì´ë‹¤.

* **êµ¬ì¡°:** **í¬ì¸í„°ë“¤ì˜ ë°°ì—´ (Array of Pointers)**
* ë©”ëª¨ë¦¬ ìƒì— ì—°ì†ëœ ê³µê°„(Contiguous Block)ì„ í• ë‹¹ë°›ëŠ”ë‹¤.
* ê·¸ ê³µê°„ì—ëŠ” ì‹¤ì œ ë°ì´í„°ê°€ ì•„ë‹ˆë¼, ë°ì´í„°ê°€ ìœ„ì¹˜í•œ ì£¼ì†Œ(Reference/Pointer)ê°€ ë“¤ì–´ê°„ë‹¤.


* **ì‹œê°í™”:**
```text
List Object (Head)
   â”‚
   â–¼
[ Ptr 0 ] â”€â”€â†’  (Int Object: 10)
[ Ptr 1 ] â”€â”€â†’  (String Object: "Hello")
[ Ptr 2 ] â”€â”€â†’  (List Object: [1,2])

```



### 1-2. ì´ì‚¬ ë¹„ìš©ì˜ ë§ˆë²•: Amortized  (ìƒê° ì‹œê°„) ğŸ 

Cì–¸ì–´ ë°°ì—´ì€ í¬ê¸°ê°€ ê³ ì •ì¸ë°, íŒŒì´ì¬ ë¦¬ìŠ¤íŠ¸ëŠ” ì–´ë–»ê²Œ ë¬´í•œëŒ€ë¡œ `append`ê°€ ë ê¹Œ?

* **Doubling Strategy (Over-allocation):**
    1. ì²˜ìŒì— ë°© 4ê°œì§œë¦¬ ë°°ì—´ì„ ë§Œë“¦.
    2. ë°ì´í„° 4ê°œê°€ ë‹¤ ì°¨ë©´? **ë°© 8ê°œ(ì•½ 1.125~2ë°°)ì§œë¦¬ ìƒˆ ì§‘ì„ ê³„ì•½í•¨.**
    3. ê¸°ì¡´ ë°ì´í„° 4ê°œë¥¼ ìƒˆ ì§‘ìœ¼ë¡œ ì´ì‚¬ì‹œí‚´(Copy).
    4. í—Œ ì§‘ì€ ì² ê±°í•¨(Free).


* **ë¹„ìš© ë¶„ì„:**
    * í‰ì†Œ `append`: ë¹ˆë°©ì— ì™ ë„£ìŒ â†’ $O(1)$ (ì¦‰ì‹œ ì™„ë£Œ)
    * ì´ì‚¬ ê°ˆ ë•Œ `append`: ì „ì²´ ë³µì‚¬ ë°œìƒ â†’ $O(N)$ (ëŠë¦¼)


* **ê²°ë¡  (Amortized):**
    * ì´ì‚¬ê°€ ê°€ë” ì¼ì–´ë‚˜ê¸° ë•Œë¬¸ì—, ì „ì²´ ë¹„ìš©ì„ ë²ˆì˜ ì—°ì‚°ìœ¼ë¡œ ë‚˜ëˆ„ë©´(1/N) í‰ê· ì ìœ¼ë¡œ $O(1)$ì— ìˆ˜ë ´í•¨.
    * **Rê³¼ì˜ ì°¨ì´:** Rì€ `c(vec, 1)` í•  ë•Œë§ˆë‹¤ ë§¤ë²ˆ ì´ì‚¬ë¥¼ ê°($O(N)$). íŒŒì´ì¬ì€ "ë¯¸ë¦¬ í° ì§‘ì„ ì‚¬ë‘ëŠ” ì „ëµ"ìœ¼ë¡œ ì´ë¥¼ ìµœì í™”í•¨.




### 1-3. ì²´í¬
* appendê°€ ë¹ ë¥¸ ê±´ "ìë¦¬ ë°°ì¹˜(Memory Allocation)" ê´€ì ì—ì„œì˜ ìµœì í™”ê³ , for ë¬¸ ëŒë©´ì„œ ì—°ì‚°í•˜ëŠ” ê±´ "ì‹¤ì œ ì‘ì—…(Computation)" ê´€ì ì¸ë°, ì—¬ê¸°ì„œ íŒŒì´ì¬ì€ "ì••ë„ì ìœ¼ë¡œ" ëŠë¦¬ë‹¤.

1. **ğŸ¢ Boxing/Unboxing Overhead (ê°ì²´ ì˜¤ë²„í—¤ë“œ)**
    * íŒŒì´ì¬ì˜ ëª¨ë“  ë³€ìˆ˜ëŠ” ë©”íƒ€ì •ë³´(íƒ€ì…, ì°¸ì¡°ê³„ìˆ˜)ë¥¼ í¬í•¨í•œ ë¬´ê±°ìš´ ê°ì²´(`PyObject`) êµ¬ì¡°ì²´
    * ë‹¨ìˆœ ì—°ì‚° ì‹œì—ë„ íƒ€ì… ê²€ì‚¬ì™€ ê°’ ì¶”ì¶œ(Unboxing) ê°™ì€ ë¶ˆí•„ìš”í•œ CPU ëª…ë ¹ì–´ë¥¼ ë§¤ë²ˆ ì‹¤í–‰
2. **ğŸ¢ Pointer Chasing & Cache Miss (ë©”ëª¨ë¦¬ ì ‘ê·¼ ì§€ì—°)**
    * ë¦¬ìŠ¤íŠ¸ëŠ” ì‹¤ì œ ê°’ì´ ì•„ë‹Œ ì£¼ì†Œ(Pointer)ë“¤ì˜ ë°°ì—´
    * ì‹¤ì œ ê°ì²´ëŠ” í™ ë©”ëª¨ë¦¬ì— ë¶ˆì—°ì†ì ìœ¼ë¡œ í©ì–´ì ¸ ìˆì–´
    * ìˆœì°¨ ì ‘ê·¼ ì‹œì—ë„ CPU ìºì‹œ ì ì¤‘ë¥ (Cache Hit)ì´ ë–¨ì–´ì§€ê³  ì¦ì€ ë©”ëª¨ë¦¬ ì ‘ê·¼ ì§€ì—°(Latency)ì´ ë°œìƒ



---

## 2. ì‹¤ìŠµ ê°€ì´ë“œ (Step-by-Step)

### 2-1. Basic Operations & The Trap of  ğŸ¢

ë¦¬ìŠ¤íŠ¸ ì¡°ì‘ í•¨ìˆ˜ë“¤ì˜ ìˆ¨ê²¨ì§„ ë¹„ìš©(Big-O)ì„ íŒŒì•…í•´ì•¼ í•œë‹¤.

| ì—°ì‚° | ì½”ë“œ | ì‹œê°„ ë³µì¡ë„ | ì„¤ëª… | ë¹„ìœ  |
| --- | --- | --- | --- | --- |
| **ì¶”ê°€ (ë’¤)** | `a.append(x)` | $O(1)$ | ë§¨ ë’¤ì— ë¶™ì„. (ì´ì‚¬ ê°€ëŠ” íƒ€ì´ë°ì—” ) | ë¹ˆ ì˜ìì— ì•‰ê¸° |
| **ì‚­ì œ (ë’¤)** | `a.pop()` | $O(1)$ | ë§¨ ë’¤ ì‚¬ëŒ ë³´ëƒ„. | ëì‚¬ëŒ í‡´ì¥ |
| **ì¶”ê°€ (ì•)** | `a.insert(0, x)` | $O(N)$ ğŸš¨ | **ì¬ì•™.** ë§¨ ì•ì— ë„£ìœ¼ë ¤ê³  ëª…ì„ í•œ ì¹¸ì”© ë’¤ë¡œ ë°€ì–´ì•¼ í•¨. | ìƒˆì¹˜ê¸° (ì „ì²´ ë’·ê±¸ìŒì§ˆ) |
| **ì‚­ì œ (ì•)** | `a.pop(0)` | $O(N)$ ğŸš¨ | ë§¨ ì• ë¹¼ê³  ë¹ˆìë¦¬ ì±„ìš°ë ¤ê³  ëª…ì„ í•œ ì¹¸ì”© ë‹¹ê²¨ì•¼ í•¨. | 1ë²ˆ í‡´ì¥ (ì „ì²´ ì•ê±¸ìŒì§ˆ) |
| **ì‚­ì œ (ê°’)** | `a.remove(x)` | $O(N)$ | ì²˜ìŒë¶€í„°  ì°¾ì•„ì„œ(Search) ì§€ìš°ê³  ë‹¹ê²¨ì•¼(Shift) í•¨. | ìˆ¨ì€ ì‚¬ëŒ ì°¾ê¸° |

> **Tip:** ì•ìª½ì—ì„œ ë„£ê³  ë¹¼ëŠ” ê²Œ ë§ë‹¤ë©´ `list` ëŒ€ì‹  `collections.deque`ë¥¼ ì¨ì•¼ í•œë‹¤. (Double Linked List êµ¬ì¡°ë¼ ì•/ë’¤ êµ¬ë¶„ì´ ì—†ìŒ)



### 2-2. Evolution to Pythonic (Comprehension) ğŸš€

Loopë¥¼ Comprehensionìœ¼ë¡œ ë°”ê¾¸ëŠ” ê±´ ë‹¨ìˆœ ìˆì½”ë”©ì´ ì•„ë‹ˆë¼ **ìµœì í™”**ë‹¤. (Pythonicì˜ ì •ìˆ˜)

### **Legacy Code (Loop):**
```python
res = []
for i in range(10):
    if i % 2 == 0:
        res.append(i * i)

```

* **Bytecode:** `LOAD_METHOD (append)` â†’ `CALL_METHOD` ë°˜ë³µ. (í•¨ìˆ˜ í˜¸ì¶œ ì˜¤ë²„í—¤ë“œ)


### **Modern Code (Comp):**
```python
res = [i * i for i in range(10) if i % 2 == 0]

```

* **Bytecode:** `LIST_APPEND`ë¼ëŠ” ì „ìš© ëª…ë ¹ì–´ê°€ ìŠ¤íƒ(Stack) ìƒì—ì„œ ë°”ë¡œ ì²˜ë¦¬.
* **ì†ë„:** í•¨ìˆ˜ í˜¸ì¶œ ê³¼ì •ì´ ìƒëµë˜ì–´ ì•½ **1.5 ~ 2ë°°** ë¹ ë¦„.


### **ğŸ§ª ì†ë„ ì°¨ì´ì˜ ê·¼ì› (C-level Loop)**

Comprehensionì€ íŒŒì´ì¬ ì¸í„°í”„ë¦¬í„° ë‚´ë¶€ì—ì„œ **Cì–¸ì–´ ë ˆë²¨ì˜ ë£¨í”„**ë¥¼ íƒ€ê²Œ ë¼.

* **For Loop:**
    * Python Interp -> `append` ì°¾ê¸° -> Python Func í˜¸ì¶œ -> C êµ¬í˜„ì²´ ì‹¤í–‰ -> Python ë³µê·€
    * (ì™”ë‹¤ ê°”ë‹¤ ì˜¤ë²„í—¤ë“œ í¼)


* **Comprehension:**
    * Python Interp -> **`LIST_APPEND` (Cì–¸ì–´ í¬ì¸í„° ì—°ì‚°ìœ¼ë¡œ ì§í–‰)**
    * (ì¤‘ê°„ ê´€ë¦¬ì ì—†ì´ ë°”ë¡œ ê½‚ì•„ ë„£ìŒ)













---

## 3. Deep Dive: `sys.getsizeof`ë¡œ ë³´ëŠ” ì¦ê±° ğŸ•µï¸â€â™‚ï¸

ì‹¤ì œ ë©”ëª¨ë¦¬ í• ë‹¹ëŸ‰ì„ ì°ì–´ë³´ë©´ íŒŒì´ì¬ì˜ **Doubling Strategy**ë¥¼ ëˆˆìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

```python
import sys

data = []
print(f"Empty: {sys.getsizeof(data)} bytes") # ê¸°ë³¸ ê»ë°ê¸° í¬ê¸°

for i in range(20):
    data.append(i)
    # ë©”ëª¨ë¦¬ ìš©ëŸ‰ì´ ê³„ë‹¨ì‹(Step)ìœ¼ë¡œ ì¦ê°€ (# ì˜ˆ: 88 bytes -> 88 -> 88 -> 120 bytes)
    print(f"Size: {len(data)}, Memory: {sys.getsizeof(data)} bytes")

```

---

## 4. Summary for R User ğŸ“

1. **Rì˜ `vector`ëŠ” ê½‰ ì°¨ ìˆë‹¤.** ì¶”ê°€í•˜ë ¤ë©´ ì „ì²´ë¥¼ ë³µì‚¬í•´ì•¼ í•´ì„œ ë£¨í”„ ì•ˆì—ì„œ `vec <- c(vec, item)` í•˜ë©´ **ì ˆëŒ€ ì•ˆ ëœë‹¤.**
2. **Pythonì˜ `list`ëŠ” í—ë í•˜ë‹¤.** ë¯¸ë¦¬ ë„‰ë„‰í•˜ê²Œ ê³µê°„ì„ ì¡ì•„ë‘ê¸° ë•Œë¬¸ì— `append`ëŠ” ê±±ì • ì—†ì´ ì¨ë„ ëœë‹¤. (**Amortized **)
3. ë‹¨, `insert(0, x)`ë‚˜ `pop(0)`ì€ **ì „ì²´ ë°ì´í„°ë¥¼ ì´ë™(Shift)**ì‹œí‚¤ë¯€ë¡œ, ë°ì´í„°ê°€ í´ ë• ì ˆëŒ€ ì“°ì§€ ë§ˆë¼. (ëŒ€ì•ˆ: `deque`)
4. `for`ë¬¸ìœ¼ë¡œ `append` í•˜ì§€ ë§ê³  **`List Comprehension`**ì„ ì¨ë¼. ê·¸ê²Œ íŒŒì´ì¬ì˜ **Vectorization**ì´ë‹¤.

---